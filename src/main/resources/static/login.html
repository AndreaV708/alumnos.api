<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Login - Sistema de Gesti√≥n de Alumnos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="login.css">
</head>
<body>
    <div class="login-container">
        <div class="login-card animate-in">
            <!-- Header del login -->
            <div class="login-header">
                <div class="logo-container">
                    <img src="logo.png" alt="Logo" class="logo">
                </div>
                <h1 class="login-title">Sistema de Gesti√≥n</h1>
                <p class="login-subtitle">Acceso Administrativo</p>
            </div>
            
            <!-- Cuerpo del formulario -->
            <div class="login-body">

                
                <!-- Panel de credenciales de prueba -->
                <div id="credentialsPanel" class="alert alert-light mb-4" style="border: 2px solid #8b3a42; background: rgba(255,255,255,0.95);">
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-info-circle-fill me-2" style="color: #8b3a42;"></i>
                        <strong style="color: #8b3a42;">Credenciales de Prueba</strong>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <small><strong style="color: #8b3a42;">üë®‚Äçüíº Admin:</strong></small><br>
                            <small>
                                Usuario: <code onclick="fillCredentials('admin', 'admin123')" style="background: #8b3a42; color: white; cursor: pointer;">admin</code><br>
                                Contrase√±a: <code onclick="fillCredentials('admin', 'admin123')" style="background: #8b3a42; color: white; cursor: pointer;">admin123</code>
                            </small>
                        </div>
                        <div class="col-md-6">
                            <small><strong style="color: #8b3a42;">üë©‚Äçüíº Secretaria:</strong></small><br>
                            <small>
                                Usuario: <code onclick="fillCredentials('secretaria', 'secretaria123')" style="background: #8b3a42; color: white; cursor: pointer;">secretaria</code><br>
                                Contrase√±a: <code onclick="fillCredentials('secretaria', 'secretaria123')" style="background: #8b3a42; color: white; cursor: pointer;">secretaria123</code>
                            </small>
                        </div>
                    </div>
                </div>
                
                <!-- Formulario de login -->
                <form id="loginForm" class="position-relative">
                    <div class="loading">
                        <div class="spinner-border spinner-border-wine" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                    
                    <!-- Campo de usuario -->
                    <div class="form-floating">
                        <input type="text" 
                               class="form-control" 
                               id="username" 
                               name="username"
                               placeholder="Usuario" 
                               required 
                               autocomplete="username">
                        <label for="username">
                            <i class="bi bi-person-fill me-2"></i>Usuario
                        </label>
                    </div>
                    
                    <!-- Campo de contrase√±a -->
                    <div class="form-floating">
                        <input type="password" 
                               class="form-control" 
                               id="password" 
                               name="password"
                               placeholder="Contrase√±a" 
                               required 
                               autocomplete="current-password">
                        <label for="password">
                            <i class="bi bi-lock-fill me-2"></i>Contrase√±a
                        </label>
                    </div>
                    
                    <!-- Botones -->
                    <button type="submit" class="btn btn-login">
                        <i class="bi bi-box-arrow-in-right me-2"></i>
                        Iniciar Sesi√≥n
                    </button>
                    
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables globales
        let showingCredentials = false;

        // Inicializaci√≥n cuando carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            // Agregar clase de animaci√≥n
            const card = document.querySelector('.login-card');
            setTimeout(() => {
                card.classList.add('animate-in');
            }, 100);

            // Enfocar el campo de usuario
            document.getElementById('username').focus();
        });

        // Funci√≥n para mostrar alertas en la esquina superior derecha
        function showAlert(message, type = 'danger', duration = 5000) {
            // Crear contenedor de toasts si no existe
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
                toastContainer.style.zIndex = '9999';
                document.body.appendChild(toastContainer);
            }
            
            const toastId = 'toast-' + Date.now();
            
            const bgClass = {
                'success': 'bg-success',
                'danger': 'bg-danger', 
                'warning': 'bg-warning',
                'info': 'bg-info'
            }[type] || 'bg-info';
            
            const toastHtml = `
                <div id="${toastId}" class="toast ${bgClass} text-white" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="bi ${getAlertIcon(type)} me-2"></i>
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
            
            // Remover el toast despu√©s de que se oculte
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }

        // Obtener icono seg√∫n el tipo de alerta
        function getAlertIcon(type) {
            const icons = {
                'success': 'bi-check-circle-fill',
                'danger': 'bi-exclamation-triangle-fill',
                'warning': 'bi-exclamation-circle-fill',
                'info': 'bi-info-circle-fill'
            };
            return icons[type] || icons['info'];
        }

        // Funci√≥n para llenar credenciales
        function fillCredentials(username, password) {
            document.getElementById('username').value = username;
            document.getElementById('password').value = password;
            
            // Efectos visuales
            const usernameField = document.getElementById('username');
            const passwordField = document.getElementById('password');
            
            usernameField.classList.add('border-success');
            passwordField.classList.add('border-success');
            
            setTimeout(() => {
                usernameField.classList.remove('border-success');
                passwordField.classList.remove('border-success');
            }, 2000);
            
            showAlert('Credenciales completadas autom√°ticamente', 'success', 3000);
        }

        // Funci√≥n para mostrar/ocultar panel de credenciales
        function showCredentials() {
            const panel = document.getElementById('credentialsPanel');
            const btn = event.target;
            
            if (showingCredentials) {
                panel.style.display = 'none';
                btn.innerHTML = '<i class="bi bi-key-fill me-2"></i>Ver Credenciales';
                showingCredentials = false;
            } else {
                panel.style.display = 'block';
                btn.innerHTML = '<i class="bi bi-eye-slash-fill me-2"></i>Ocultar Credenciales';
                showingCredentials = true;
            }
        }

        // Mostrar loading
        function showLoading() {
            document.querySelector('.loading').style.display = 'block';
            document.getElementById('loginForm').style.opacity = '0.7';
        }

        // Ocultar loading
        function hideLoading() {
            document.querySelector('.loading').style.display = 'none';
            document.getElementById('loginForm').style.opacity = '1';
        }

        // Manejar env√≠o del formulario
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            // Validaciones b√°sicas
            if (!username || !password) {
                showAlert('Por favor, complete todos los campos', 'warning');
                return;
            }
            
            // Mostrar loading
            showLoading();
            
            try {
                // Llamar a la API de login
                const response = await fetch('http://localhost:8081/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });
                
                if (response.ok) {
                    const loginData = await response.json();
                    
                    // Guardar informaci√≥n del usuario
                    localStorage.setItem('userSession', JSON.stringify({
                        username: loginData.username,
                        rol: loginData.rol,
                        nombreCompleto: loginData.nombreCompleto,
                        token: loginData.token
                    }));
                    
                    const userType = loginData.rol === 'ADMINISTRADOR' ? 'Administrador' : 'Secretaria';
                    showAlert(`¬°Acceso autorizado como ${userType}! Redirigiendo...`, 'success');
                    
                    setTimeout(() => {
                        window.location.href = `index.html?user=${encodeURIComponent(loginData.nombreCompleto)}`;
                    }, 1500);
                } else {
                    hideLoading();
                    showAlert('Credenciales incorrectas. Por favor, intente nuevamente.', 'danger');
                    
                    // Limpiar campos
                    document.getElementById('password').value = '';
                    document.getElementById('username').focus();
                }
            } catch (error) {
                console.error('Error en el login:', error);
                hideLoading();
                showAlert('Error de conexi√≥n. Por favor, intente nuevamente.', 'danger');
                
                // Limpiar campos
                document.getElementById('password').value = '';
                document.getElementById('username').focus();
            }
        });

        // Efectos adicionales en los campos
        const formControls = document.querySelectorAll('.form-control');
        formControls.forEach(control => {
            control.addEventListener('focus', function() {
                this.parentElement.classList.add('focused');
            });
            
            control.addEventListener('blur', function() {
                this.parentElement.classList.remove('focused');
            });
        });

        // Animaci√≥n del logo
        const logo = document.querySelector('.logo');
        logo.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1) rotate(5deg)';
        });
        
        logo.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1) rotate(0deg)';
        });

        // Easter egg: doble click en el logo
        logo.addEventListener('dblclick', function() {
            showAlert('üéâ ¬°Has encontrado el easter egg! Sistema desarrollado con ‚ù§Ô∏è', 'info', 4000);
        });

        // Soporte para Enter en los campos
        document.getElementById('username').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('password').focus();
            }
        });

        // Inicializar panel de credenciales como oculto
        document.addEventListener('DOMContentLoaded', function() {
            showingCredentials = true;
            showCredentials(); // Esto lo ocultar√° inicialmente
        });
    </script>
</body>
</html>
